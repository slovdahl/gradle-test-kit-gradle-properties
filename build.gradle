import java.lang.management.ManagementFactory

/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/6.8/samples
 */

apply plugin: 'java'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation gradleTestKit()

    testImplementation "org.junit.jupiter:junit-jupiter-api:5.7.0"
    testImplementation "org.junit.jupiter:junit-jupiter-params:5.7.0"
    testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:5.7.0"
}

task run {
    doLast {
        long maximumHeap = ManagementFactory.getMemoryMXBean().getHeapMemoryUsage().getMax()

        throw new IllegalStateException(
                "maximum heap size: " + maximumHeap + " bytes, " + maximumHeap / 1024 / 1024 + " MiB\n" +
                        "PID: " + ManagementFactory.getRuntimeMXBean().getName()
        );
    }
}

test {
    systemProperty "gradleRootDirectory", project.rootDir.getAbsolutePath()

    useJUnitPlatform()

    testLogging {
        exceptionFormat = 'full'
    }
}
